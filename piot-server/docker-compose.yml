version: '2'
volumes:
  sense-data:
services:
  piot-server:
    build: .
    restart: always
    expose:
      - 8080
    ports:
      - "8080:8080"
    depends_on:
      - mqtt

  mqtt:
    image: arm32v6/eclipse-mosquitto
    restart: always
    expose:
      - "1883"
      - "9001"
    ports:
      - "1883:1883"
      - "9001:9001"

  influxdb:
    restart: always
    build: ./influxdb
    volumes:
      - 'sense-data:/data'

  grafana:
    restart: always
    build: ./grafana
    ports:
      - "80"
    volumes:
      - 'sense-data:/data'
    environment:
      - 'GF_SERVER_HTTP_PORT=80'
      - 'GF_PATHS_PROVISIONING=/usr/src/app/provisioning'
      - 'GF_SESSION_PROVIDER=memory'
    depends_on:
      - influxdb
